<?xml version='1.0' encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:p="http://primefaces.org/ui" template="/layout/template.xhtml">
	
	<ui:define name="content">
		<h:form id="frmLink">
			<p:focus for="dtbLink:globalFilter"/>
		
			<p:panelGrid columns="1" layout="grid" styleClass="panelgrid-noborder">
				<p:outputPanel>
					<i class="fa fa-link"/>
					&nbsp;
					<h:outputText value="Cadastro de link" style="font-size: 14px;" styleClass="label-negrito"/>
				</p:outputPanel>
				
				<hr class="hr-header"/>
				
				<p:messages id="msgLink" redisplay="false" closable="true"/>
				
				<p:dataTable id="dtbLink" var="link" widgetVar="dtb_link" value="#{cadastroLinkBean.links}" filteredValue="#{cadastroLinkBean.filtrados}"
					paginator="true" paginatorAlwaysVisible="true" paginatorPosition="both"
					paginatorTemplate="{FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					rows="20" rowsPerPageTemplate="10,20,30,40" currentPageReportTemplate="Página {currentPage} de {totalPages} - {totalRecords} registro(s)"
					resizableColumns="true" rowKey="#{link.id}" rowIndexVar="rowIndex" emptyMessage="#{msg['aviso.VAZIO']}" rowStyleClass="#{link.ativo ? null : 'label-gray'}" style="margin-top: -4px;">
					
					<f:facet name="header">
						<p:toolbar>
							<p:toolbarGroup align="left" style="border: 0px;">
								<p:commandButton value="Incluir" icon="fa fa-file" actionListener="#{cadastroLinkBean.onIncluir()}" 
									update="frmLink:msgLink :dlgCadastrar" oncomplete="PF('dlg_cadastrar').show();" style="margin-left: 3px;">
									<p:resetInput target="frmCadastrar"/>
									
									<f:setPropertyActionListener value="Incluir" target="#{acao}"/>
								</p:commandButton>
							</p:toolbarGroup>
							
							<p:toolbarGroup align="right">
								<h:outputText value="Filtro:"/>
								&nbsp; 
								<p:inputText id="globalFilter" onkeypress="if (event.keyCode == 13) {
																		       PF('dtb_link').filter();

							       											   return false;
																		   }" style="width: 150px;"/>
							</p:toolbarGroup>
						</p:toolbar> 
					</f:facet>
					
					<p:ajax event="filter" listener="#{cadastroLinkBean.onFiltrar()}" update="dtbLink"/>
					
					<p:column headerText="Título" sortBy="#{link.titulo}" styleClass="link-titulo">
						<h:outputText value="#{link.titulo}"/>
					</p:column>
					
					<p:column headerText="URL" sortBy="#{link.url}" styleClass="link-url">
						<p:link value="#{link.url}" href="#{link.url}" target="_&#66;lank" styleClass="link"/>
					</p:column>
					
					<p:column styleClass="link-acao">
						<p:commandLink title="Detalhar" actionListener="#{cadastroLinkBean.onDetalhar(link)}" 
							update="frmLink:msgLink :dlgCadastrar" oncomplete="PF('dlg_cadastrar').show();">
							<i class="fa fa-eye"/>
							
							<f:setPropertyActionListener value="Detalhar" target="#{acao}"/>
						</p:commandLink>
						<p:spacer width="8"/>
						<p:commandLink title="Alterar" actionListener="#{cadastroLinkBean.onAlterar(link)}" 
							update="frmLink:msgLink :dlgCadastrar" oncomplete="PF('dlg_cadastrar').show();">
							<i class="fa fa-edit"/>
							
							<p:resetInput target="frmCadastrar"/>
							
							<f:setPropertyActionListener value="Alterar" target="#{acao}"/>
						</p:commandLink>
						<p:spacer width="8"/>
						<p:commandLink title="Excluir" action="#{cadastroLinkBean.excluir(link)}" update="frmLink:msgLink :frmMenu:pnmAjuda" oncomplete="PF('dtb_link').filter(); $(window).scrollTop(0);">
							<i class="fa fa-trash"/>
							
							<p:confirm header="Excluir" message="#{msg['aviso.CONFIRMAR']}"/>
						</p:commandLink>
					</p:column>
					
					<p:column filterMatchMode="contains" filterBy="#{link.titulo}" rendered="false"/>
					<p:column filterMatchMode="contains" filterBy="#{link.url}" rendered="false"/>
				</p:dataTable>
				
				<p:spacer height="8"/>
			</p:panelGrid>
		</h:form>
		
		<!-- cadastrar. -->
		<p:dialog id="dlgCadastrar" widgetVar="dlg_cadastrar" header="#{acao}" resizable="false" modal="true" position="center"
		 	width="auto" height="auto" closable="true" closeOnEscape="true" fitViewport="true" responsive="true" styleClass="dialog">
			<h:form id="frmCadastrar">
				<p:focus for="titulo"/>
			
				<h:panelGrid columns="1" rendered="#{not empty cadastroLinkBean.link}">
					<p:messages id="msgCadastrar" redisplay="false" closable="true"/>
					
					<p:panel style="margin-bottom:0.5em;">
						<p:outputPanel rendered="#{acao.equals('Detalhar')}">
							<h:panelGrid columns="2" width="500" columnClasses="nome largura20" rowClasses="valor">
								<f:facet name="header">
									<div align="left">
										<hr class="hr-header"/>
									</div>
								</f:facet>
								
								<p:outputLabel value="Título:"/>
								<h:outputText value="#{cadastroLinkBean.link.titulo}"/>
								
								<p:outputLabel value="URL:"/>
								<p:link value="#{cadastroLinkBean.link.url}" href="#{cadastroLinkBean.link.url}" target="_&#66;lank" styleClass="link"/>
								
								<p:outputLabel value="Ativo:"/>
								<p:selectBooleanCheckbox value="#{cadastroLinkBean.link.ativo}" disabled="true"/>
								
								<f:facet name="footer">
									<hr class="hr-footer"/>
									
									<p:commandButton value="Fechar" icon="fa fa-window-close" immediate="true" oncomplete="PF('dlg_cadastrar').hide();"/>
								</f:facet>
							</h:panelGrid>
						</p:outputPanel>
						
						<p:outputPanel rendered="#{not acao.equals('Detalhar')}">
							<h:panelGrid columns="2" width="100%" columnClasses="nome largura20" rowClasses="valor">
								<f:facet name="header">
									<div align="left">
										<hr class="hr-header"/>
									</div>
								</f:facet>
								
								<p:outputLabel value="Título:" for="titulo"/>
								<p:inputText value="#{cadastroLinkBean.link.titulo}" id="titulo" size="50" maxlength="255" required="true" requiredMessage="#{msg['validacao.cadastro.link.TITULO']}"/>
								
								<p:outputLabel value="URL:" for="url"/>
								<p:inputText value="#{cadastroLinkBean.link.url}" id="url" size="100" maxlength="1000" required="true" requiredMessage="#{msg['validacao.cadastro.link.URL']}"/>
								
								<p:outputLabel value="Ativo:" for="ativo"/>
								<p:selectBooleanCheckbox value="#{cadastroLinkBean.link.ativo}" id="ativo"/>
								
								<f:facet name="footer">
									<hr class="hr-footer"/>
									
									<p:outputLabel value="* campo obrigatório"/>
									<br/><br/>
									
									<p:commandButton value="Salvar" icon="fa fa-save" action="#{cadastroLinkBean.salvar()}" update="frmCadastrar :frmMenu:pnmAjuda" oncomplete="PF('dtb_link').filter();"/> 
									<p:spacer width="8"/>
									<p:commandButton value="Fechar" icon="fa fa-window-close" immediate="true" oncomplete="PF('dlg_cadastrar').hide();"/>
								</f:facet>
							</h:panelGrid>
						</p:outputPanel>
					</p:panel>
				</h:panelGrid>
			</h:form>
		</p:dialog>
	</ui:define>
	
</ui:composition>
